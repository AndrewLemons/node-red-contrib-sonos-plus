<!-- Sonos Manage Queue Node -->

<!-- Registering Node -->
<script type="text/javascript">
RED.nodes.registerType('sonos-manage-queue', {
  category: 'SonosPlus',
  defaults: {
    confignode: {
      value: '',
      type: 'sonos-config'
    },
    name: {
      value: ''
    }
  },
  inputs: 1, // set the number of inputs - only 0 or 1
  outputs: 1, // set the number of outputs - 0 to n
  icon: 'sonos.png', // saved in  icons/myicon.png
  color: '#9dc1ec',
  label: function () {
    return this.name || 'Manage Queue';
  },
  paletteLabel: 'Mng Queue'
});
</script>

<!-- Setting design and inputs for node -->
<script type="text/x-red" data-template-name="sonos-manage-queue">

  <div class="form-row">
        <label for="node-input-confignode"> Config Node</label>
        <input type="text" id="node-input-confignode">
  </div>

	<div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="This Node Name">
  </div>

</script>


<!-- Help Text -->
<script type="text/x-red" data-help-name="sonos-manage-queue">
  <p> Incoming message is being converted to valid command and send to SONOS player. The <i>get ... </i> provides information about the current queue or playlists.</p>

  <h3>Input (required)</h3>

  <dl class="message-properties">

      <dt>payload <span class="property-type">string</span> </dt>
      <dd>A command. Valid commands see Details.</dd>

      <dt>topic <span class="property-type">string</span> </dt>
      <dd>Command parameter only used for some commands.</dd>

      <dt>volume <span class="property-type">string</span> </dt>
      <dd>Volume being used together with <b>activate_queue</b></dd>

      <dt>size <span class="property-type">string</span> </dt>
      <dd>Size (maximum number of playlists) being used together with <b>insert_musiclibrary_playlist, get_musiclibrary_playlists</b>.</dd>
  </dl>

  <h3>Outputs</h3>

  <dl class="message-properties">
      <dt>payload
          <span class="property-type">Array</span>
      </dt>
      <dd>Array of songs or playlists in case of <i>get</i> command.</dd>
  </dl>

  <dl class="message-properties">
      <dt>queue_length
          <span class="property-type">number</span>
      </dt>
      <dd>Number of songs in the SONOS queue</i></dd>
  </dl>

  <dl class="message-properties">
      <dt>available_playlists
          <span class="property-type">number</span>
      </dt>
      <dd>Number of SONOS playlists</i></dd>
  </dl>

  <h3>Details</h3>

  Accepted values for <code>payload</code> are:
  <br/> • <b>activate_queue</b> Starts playing songs from queue (checks queue is not empty)
  <br/> • <b>insert_uri</b> Inserts a song or a complete playlist into queue
  <br/> • <b>insert_prime_playlist</b> Inserts all songs of a Amazon Prime playlist into queue (topic is uri)
  <br/> • <b>insert_sonos_playlist</b> Inserts all songs of a Sonos playlist into queue (topic provides search string)
  <br/> • <b>insert_musiclibrary_playlist</b> Inserts all songs of a Music Library playlist into queue (topic provides search string)
  <br/> • <b>play_song</b> Plays a specific song in queue. (checks valid position)
  <br/> • <b>remove_song</b> Removes a specific song from queue. (checks valid position)
  <br/> • <b>flush_queue</b> Erases the queue and stops playing!
  <br/> • <b>set_queuemode</b> Set queue mode to NORMAL, REPEAT_ONE, REPEAT_ALL, SHUFFLE, SHUFFLE_NOREPEAT, SHUFFLE_REPEAT_ONE
  <br/> • <b>get_queue</b> Outputs the current queue as output
  <br/> • <b>get_queuemode</b> Gets the current queue mode (e. g SHUFFLE, NORMAL, ...)
  <br/> • <b>get_sonos_playlists</b> Outputs an array of all Sonos playlists
  <br/> • <b>get_prime_playlists</b> Outputs an array of all My Sonos Amazon Prime playlists
  <br/> • <b>get_musiclibrary_playlists</b> Outputs an array of all Music Library playlists

The msg.size property specifies the buffer size for retrieving Music library playlists. If you have more then 100 imported Music Library playlist you can use this property to increase the buffer size. 
</script>
