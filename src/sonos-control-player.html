<!-- Sonos Control Player Node -->

<!-- Registering Node -->
<script type="text/javascript">
RED.nodes.registerType('sonos-control-player', {
  category: 'SonosPlus',
  defaults: {
    confignode: {
      value: '',
      type: 'sonos-config'
    },
    name: {
      value: ''
    }
  },
  inputs: 1, // set the number of inputs - only 0 or 1
  outputs: 0, // set the number of outputs - 0 to n
  icon: 'sonos.png', // saved in  icons/myicon.png
  color: '#f1e9e3',
  label: function () {
    return this.name || 'Control Player';
  },
  paletteLabel: 'Ctrl Player'
});
</script>

<!-- Setting design and inputs for node -->
<script type="text/x-red" data-template-name="sonos-control-player">

  <div class="form-row">
        <label for="node-input-confignode"> Config Node</label>
        <input type="text" id="node-input-confignode">
    </div>

	<div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="This Node Name">
  </div>

</script>


<!-- Help Text -->
<script type="text/x-red" data-help-name="sonos-control-player">
  <p>Incoming message is being converted to valid command and send to SONOS player.</p>

  <h3>Input</h3>

  <dl class="message-properties">
      <dt>payload (always required)
          <span class="property-type">string</span>
      </dt>
      <dd>A command. Valid commands see Details.</dd>
      <dt>topic
          <span class="property-type">string</span>
      </dt>
      <dd>Command parameter for <i>join_group, activate_avtransport</i></dd>
  </dl>

  <h3>Details</h3>
  <p><code>msg.payload</code> is used as command. <code>msg.topic</code> is used as command parameter and currently only being used in combination with the <i>"join_group/activate_avtransport"</i> command.</p>

  Accepted values for <code>msg.payload</code> are:
    <br/> • <i>play/stop/pause/mute/ummute/next_song/previous_song</i> Obvious
    <br/> • <i>toggleplayback</i> Toggles play/stop
    <br/> • <i>number</i>: 0 .. 100 Set volume
    <br/> • <i>+number</i>: +1 .. +30 Increase volume CAUTION: use string not number format!
    <br/> • <i>-number</i>: -30 .. -1 Decrease volume
    <br/> • <i>leave_group</i> Leave group
    <br/> • <i>join_group</i> Join group. Group name must be specified in <code>msg.topic</code>.
    <br/> • <i>activate_avtransport</i> Activates a specific stream - e.g. line in. URI must be specified in <code>msg.topic</code>.
    <br/> • <i>play_notification</i> Plays a given notification. Notification must be specified in <code>msg.topic</code>. <code>msg.volume</code> may contain the notificaiton volume in the range from 0 to 100. Default is 40.

<br/><br/>The commands <b>next_song/previous_song</b> don't work with TuneIn radio stations. Amazon Prime radion stations support "next_song" but not "previous_song".

<br/><br/> <b>Play a notification</b> is NOT a build in SONOS function. Instead the currenst state is stored, then the notification beeing played and then the previous state restored.
This works with the following restrictions:
<br/> • Do NOT play another notification while one is playing.
<br/> • If a Amazon Prime stations is playing, the next song will start after notification has ended.
</script>
